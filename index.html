<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Hydra + p5 Micro Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <script src="visualizer_hydra-synth.js"></script>
  <script src="visualizer_p5.min.js"></script>
  <script src="visualizer_p5.sound.min.js"></script>
 
  <style>
    body, html {
      margin: 0;
      background: black;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      color: white;
      font-family: sans-serif;
    }
    button {
      font-size: 1.5rem;
      padding: 1rem 2rem;
      border: none;
      border-radius: 0.5rem;
      background: #1e90ff;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <button id="startButton">ðŸŽ¤ DÃ©marrer Visualisation Audio</button>

  <script>
    document.getElementById("startButton").addEventListener("click", () => {
      document.getElementById("startButton").style.display = "none";

      let mic, fft;
      let hydra = new Hydra({ detectAudio: false });

      document.body.appendChild(hydra.canvas);

      new p5(p => {
        p.setup = function () {
          p.noCanvas();

          mic = new p5.AudioIn();
          mic.start(() => {
            console.log("ðŸŽ¤ Micro activÃ©");
          }, (err) => {
            console.error("Erreur micro :", err);
          });

          fft = new p5.FFT();
          fft.setInput(mic);

          drawHydra();
        };

        function drawHydra() {
          let spectrum = fft.analyze();
          let bass = fft.getEnergy("bass") / 255;
          let mid = fft.getEnergy("mid") / 255;
          let treble = fft.getEnergy("treble") / 255;

          console.log(`ðŸŽ¶ Bass: ${bass.toFixed(2)} | Mid: ${mid.toFixed(2)} | Treble: ${treble.toFixed(2)}`);

          // GÃ©nÃ©rer la visualisation Hydra
          osc(10, 0.03, 0.8)
            .color(
              0.3 + bass * 1.5,
              0.4 + mid * 1.2,
              0.5 + treble * 1.3
            )
            .rotate(() => time * 0.02 + mid * 0.1)
            .kaleid(6)
            .scale(1 + bass * 0.3)
            .blend(o0, 0.2)
            .out();

          requestAnimationFrame(drawHydra);
        }
      });
    });
  </script>
</body>
</html>
