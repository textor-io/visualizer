<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Hydra + p5 Micro Test</title>
    <script src="visualizer_hydra-synth.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/addons/p5.sound.min.js"></script>

  <style>
    html, body {
      margin: 0;
      overflow: hidden;
      background: black;
    }
  </style>
</head>
<body>
  <script>
    let mic, fft, hydra;
    let bass = 0, mid = 0, treble = 0;

    function setup() {
      noCanvas();

      // Initialisation micro
      mic = new p5.AudioIn();
      mic.start(() => {
        console.log("ðŸŽ¤ Micro activÃ©");
      });

      // Analyseur FFT
      fft = new p5.FFT();
      fft.setInput(mic);

      // Initialisation dâ€™Hydra sans audio natif
      hydra = new Hydra({ detectAudio: false });
      document.body.appendChild(hydra.canvas);

      // Lancer l'animation
      drawHydra();

      // Debug volume
      setInterval(() => {
        let lvl = mic.getLevel();
        console.log(`ðŸŽš Niveau micro : ${lvl.toFixed(3)} | Bass: ${bass.toFixed(2)} Mid: ${mid.toFixed(2)} Treble: ${treble.toFixed(2)}`);
      }, 1000);
    }

    function drawHydra() {
      // Lire donnÃ©es FFT
      let spectrum = fft.analyze();
      bass = fft.getEnergy("bass") / 255;
      mid = fft.getEnergy("mid") / 255;
      treble = fft.getEnergy("treble") / 255;

      // Visualisation Hydra avec rÃ©activitÃ© audio
      osc(10, 0.03, 0.8)
        .color(
          () => 0.3 + bass * 1.5,
          () => 0.4 + mid * 1.2,
          () => 0.5 + treble * 1.3
        )
        .rotate(() => time * 0.02 + mid * 0.1)
        .modulate(
          osc(5, 0.02).rotate(() => time * 0.1 + mid * 0.5),
          0.3
        )
        .kaleid(6)
        .scale(() => 1 + bass * 0.4)
        .add(
          shape(6, 0.3, 0.2)
            .scale(() => 0.8 + bass * 0.5)
            .rotate(() => time * 0.05 + treble * 0.2)
            .color(0.9, 0.6, 0.3)
            .mult(
              osc(20).rotate(() => 0.5 + mid * 0.3)
            )
            .modulate(noise(3).rotate(0.2), 0.15)
        )
        .blend(o0, 0.25)
        .out();

      requestAnimationFrame(drawHydra);
    }
  </script>
</body>
</html>
