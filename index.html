<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Hydra + p5 AudioIn Visualizer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Librairies -->
  <script src="visualizer_p5.min.js"></script>
  <script src="visualizer_p5.sound.min.js"></script>
  <script src="visualizer_hydra-synth.js"></script>
  <style>
    html, body {
      margin: 0;
      background: black;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <script>
    new p5(p => {
      let hydra;
      let mic, fft;
      let isAudioActive = false;

      p.setup = () => {
        p.noCanvas();

        mic = new p5.AudioIn();
        mic.start(() => {
          console.log("ðŸŽ¤ Micro activÃ©");
          isAudioActive = true;
        });

        fft = new p5.FFT();
        fft.setInput(mic);

        hydra = new Hydra({ detectAudio: false });
        document.body.appendChild(hydra.canvas);

        drawHydra();
      };

      function drawHydra() {
        let spectrum = fft.analyze();

        // Calculs d'Ã©nergie normalisÃ©e
        let bass = fft.getEnergy("bass") / 255;
        let lowMid = fft.getEnergy("lowMid") / 255;
        let mid = fft.getEnergy("mid") / 255;
        let highMid = fft.getEnergy("highMid") / 255;
        let treble = fft.getEnergy("treble") / 255;

        // Moyenne globale de l'Ã©nergie
        let avgEnergy = (bass + lowMid + mid + highMid + treble) / 5;

        // Sâ€™il nâ€™y a presque pas de son â†’ fond noir
        if (avgEnergy < 0.02 || !isAudioActive) {
          solid(0, 0, 0).out(o0);
          requestAnimationFrame(drawHydra);
          return;
        }

        // Forme centrale qui "danse"
        osc(10, 0.03, 0.8)
          .color(
            0.3 + bass * 1.5,
            0.4 + mid * 1.2,
            0.5 + treble * 1.3
          )
          .rotate(time * 0.02 + lowMid * 0.15)
          .modulate(
            osc(5, 0.02).rotate(time * 0.1 + mid * 0.5),
            0.3
          )
          .kaleid(6)
          .scale(1 + lowMid * 0.4)
          .add(
            shape(6, 0.3, 0.2)
              .scale(0.8 + bass * 0.5)
              .rotate(time * 0.05 + treble * 0.2)
              .color(0.9, 0.6, 0.3)
              .mult(
                osc(20).rotate(0.5 + lowMid * 0.3)
              )
              .modulate(noise(3).rotate(0.2), 0.15)
          )
          .blend(o0, 0.25)
          .out();

        requestAnimationFrame(drawHydra);
      }
    });
  </script>
</body>
</html>
